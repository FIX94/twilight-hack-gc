// Copyright 2008-2009  Segher Boessenkool  <segher@kernel.crashing.org>
// GameCube Port Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

#define XSTR(x) #x
#define ISTR(x) XSTR(x)

	.section .start,"ax"

	// Uninteresting stuff.
	.incbin "head.b"

	// "Link".  This is displayed on the load menu, so make it nice.
0:	.ascii ISTR(NAME)
	.fill 17 - (. - 0b)

	// "Epona".  Hungry horse eats the stack.
	.fill 0xe4,1,'3'

	// The return address on the stack.
	.long start

	// Align things properly -- there's code after this.
	.fill 0x1f,1,'S'
	.balign 4,0

start:
	// Disable interrupts, enable FP.
	mfmsr 3 ; rlwinm 3,3,0,17,15 ; ori 3,3,0x2000 ; mtmsr 3 ; isync

	// Set up a stack frame.
	lis 1,0x8080 ; li 0,0 ; stwu 0,-64(1)

	// Go for it!
	b _main
